!function(a,b,c,d){"use strict";function l(b,c){f=this,this.element=b,a(this.element).wrapInner('<div class="balanced-gallery-container"></div>'),this.container=a(this.element).children()[0],this.elementChildren=a(this.container).children("img"),this.options=a.extend({},g,c),this.options.orientation=this.options.orientation.toLowerCase(),this.options.autoResize&&(this.unadulteratedCSS={width:a(this.element)[0].style.width},this.unadulteratedOptions=a.extend({},this.options),m()),this.quickResize=!1,this.init(),this.createGallery()}function m(){a(b).resize(function(){clearTimeout(h),h=setTimeout(function(){f.recreate()},500)})}function n(){var a,b,c;f.quickResize?D():(a=p(),b=t(),c=v(b,a),C(c)),I(f.options.orientation)}function o(){var a,b,c;f.quickResize?F():(a=q(),b=u(),c=v(b,a),J(c),E(c)),I(f.options.orientation),H()}function p(){var a=Math.round(r()/f.options.viewportWidth);return a>0&&a<1&&(a=1),a}function q(){var a=Math.round(f.options.viewportWidth/f.options.idealWidth),b=f.elementChildren.length;return a<=b?a:b}function r(){var b=0;return f.elementChildren.each(function(){b+=s(a(this))}),b}function s(a){return K(a)*f.options.idealHeight+f.options.padding}function t(){return f.elementChildren.map(function(){var b=K(a(this));return{element:this,weight:b}})}function u(){return f.elementChildren.map(function(){var b=1/K(a(this));return{element:this,weight:b}})}function v(a,b){if(f.options.maintainOrder)return w(a,b);var c=y(a,b);return f.options.shuffleUnorderedPartitions&&(c=A(c)),B(c),c}function w(a,b){var c=a.length;if(b<=0)return[];var d=x(a,b);c-=1,b-=2;for(var e=[],f=[];b>=0;){f=[];for(var g=d[c-1][b]+1;g<c+1;g++)f.push(a[g]);e=[f].concat(e),c=d[c-1][b],b-=1}for(var h=[],i=0;i<c+1;i++)h.push(a[i]);return[h].concat(e)}function x(a,b){for(var c=a.length,d=[],e=0;e<c;e++){for(var f=[],g=0;g<b;g++)f.push(0);d.push(f)}for(var h=[],i=0;i<c-1;i++){for(var j=[],k=0;k<b-1;k++)j.push(0);h.push(j)}for(var l=0;l<c;l++)d[l][0]=a[l].weight+(0!==l?d[l-1][0]:0);for(var m=0;m<b;m++)d[0][m]=a[0].weight;for(var n=function(a,b){return a[0]-b[0]},o=1;o<c;o++)for(var p=1;p<b;p++){for(var q=[],r=0;r<o;r++)q.push([Math.max(d[r][p-1],d[o][0]-d[r][0]),r]);var s=q.sort(n)[0];d[o][p]=s[0],h[o-1][p-1]=s[1]}return h}function y(a,b){for(var c=a.sort(function(a,b){return b.weight-a.weight}),d=new Array(b),e=0;e<b;e++)d[e]=[];for(var f=0;f<c.length;f++){for(var g=d[0],h=z(g),i=0;i<d.length;i++){var j=z(d[i]);j<h&&(g=d[i],h=j)}g.push(c[f])}return d}function z(b){var c=0;return a.each(b,function(a,b){c+=b.weight}),c}function A(a){for(var b=0;b<a.length;b++)a[b]=L(a[b]);return L(a)}function B(b){a(f.container).html("");for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++)a(f.container).append(d[e].element)}function C(b){var c=f.options.padding,d=0;f.resizingValue=[];for(var e=0;e<b.length;e++){for(var g=0,h=0;h<b[e].length;h++)g+=b[e][h].weight;f.resizingValue[e]={ratio:g,length:b[e].length},k=0;for(var j=c*b[e].length,l=(f.options.viewportWidth-j)/g,m=0;m<b[e].length;m++){var n=a(b[e][m].element);f.elementChildren[d++]=n;var o=parseInt(l,i),p=l*K(n);p=G(p),n.width(p),n.height(o),n.css({margin:0,marginRight:c+"px",marginBottom:c+"px"})}}}function D(){for(var d,e,a=f.options.padding,b=0,c=0,g=0;g<f.elementChildren.length;g++){g==c&&(e=a*f.resizingValue[b].length,d=(f.options.viewportWidth-e)/f.resizingValue[b].ratio,c+=f.resizingValue[b].length,b++,k=0);var h=f.elementChildren[g],j=parseInt(d,i),l=d*K(h);l=G(l),h.width(l),h.height(j)}}function E(b){var c=f.options.padding,d=[],e=0,g=0;f.resizingValue=[],k=0;for(var h=0;h<b.length;h++){d[h]=0;for(var i=0;i<b[h].length;i++)d[h]+=b[h][i].weight;d[h]+=b[h].length*(c/(f.options.idealWidth-c)),e+=d[h]}f.summedColRatios=e;for(var j=e/b.length,l=0;l<b.length;l++){for(var m=j-d[l],n=j+m,o=f.options.viewportWidth/e*n,p=o-c,q=G(p),r=0,s=0;s<b[l].length;s++){var t=a(b[l][s].element);f.elementChildren[g++]=t;var u=Math.round(p*(1/K(t)));r+=u+c,t.width(q),t.height(u),t.css({margin:0,marginRight:c+"px",marginBottom:c+"px"})}f.resizingValue[l]={ratio:n,length:b[l].length,columnHeight:r}}}function F(){var a=f.options.padding,b=-1,c=0;k=0;for(var d,e,g,h=0;h<f.elementChildren.length;h++){h==c&&(b++,f.resizingValue[b].columnHeight=0,d=f.options.viewportWidth/f.summedColRatios*f.resizingValue[b].ratio,e=d-a,g=G(e),c+=f.resizingValue[b].length);var j=f.elementChildren[h],l=parseInt(e*(1/K(j)),i);f.resizingValue[b].columnHeight+=l+a,j.width(g),j.height(l)}}function G(a){var b=parseInt(a,i);return k+=a-b,k>=j&&(b+=1,k-=1),b}function H(){for(var a=0,b=0,c=0;c<f.resizingValue.length;c++)a+=f.resizingValue[c].columnHeight;a=Math.round(a/f.resizingValue.length);for(var d=0;d<f.resizingValue.length;d++){b+=f.resizingValue[d].length;for(var e=Math.sign(a-f.resizingValue[d].columnHeight),g=b-1;a!=f.resizingValue[d].columnHeight;)f.elementChildren[g].height(f.elementChildren[g].height()+e),f.resizingValue[d].columnHeight+=e,g--,g<b-f.resizingValue[d].length&&(g=b-1)}}function I(b){f.options.viewportWidth+f.options.padding!==a(f.element).width()&&(f.options.viewportWidth=a(f.element).width()-f.options.padding,a(f.container).width(f.options.viewportWidth),"horizontal"==b?D():"vertical"==b&&F())}function J(b){var c=a(f.container);c.html("");for(var d=0;d<b.length;d++){var e="balanced-gallery-col"+d,g='<div class="balanced-gallery-column" id="'+e+'" style="float: left; padding: 0; margin: 0;"></div>';c.append(g);for(var h=a(c.find("div#"+e)),i=0;i<b[d].length;i++){var j=b[d][i].element;h.append(j).append('<br style="display: block;"/>')}}var k='<div class="balanced-gallery-clearing" style="clear: both;"></div>';c.append(k)}function K(a){return a[0].naturalWidth/a[0].naturalHeight}function L(a){for(var c,d,b=a.length;b--;)d=Math.random()*b|0,c=a[b],a[b]=a[d],a[d]=c;return a}var f,e="BalancedGallery",g={autoResize:!0,background:null,idealHeight:null,idealWidth:null,maintainOrder:!0,orientation:"horizontal",padding:5,shuffleUnorderedPartitions:!0,widthDivisor:4},h=null,i=10,j=.99999,k=0;a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new l(this,b))})},l.prototype.recreate=function(){this.options=a.extend({},this.unadulteratedOptions),a(this.element).css(this.unadulteratedCSS),f.quickResize=!0,f.init(),f.createGallery()},l.prototype.init=function(){if(f.quickResize===!1){this.elementChildren.each(function(){a(this).css({display:"inline-block",padding:0,margin:0})});var b=this.options.padding+"px";a(this.container).css({fontSize:0,paddingTop:b,paddingLeft:b}),null!==this.options.background&&a(this.container).css({background:this.options.background})}this.options.viewportWidth=a(this.element).width()-this.options.padding,null===this.options.idealWidth&&(this.options.idealWidth=this.options.viewportWidth/this.options.widthDivisor),null===this.options.idealHeight&&(this.options.idealHeight=this.options.viewportWidth/this.options.widthDivisor),a(this.container).width(this.options.viewportWidth)},l.prototype.createGallery=function(){var a=this.options.orientation;if("horizontal"===a)n();else{if("vertical"!==a)throw"BalancedGallery: Invalid Orientation.";o()}}}(jQuery,window,document);